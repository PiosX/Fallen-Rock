function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,i){if("object"!==_typeof(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===i?String:Number)(t);e=e.call(t,i||"default");if("object"!==_typeof(e))return e;throw new TypeError("@@toPrimitive must return a primitive value.")}var UIBlock=function(){function t(){_classCallCheck(this,t),this._x=0,this._y=0,this._oldX=0,this._oldY=0,this._visible=!0,this._displayWidth=0,this._displayHeight=0,this.children=[],this.childIndex=-1,this.isPosBlock=!0,this._depth=1,this._alpha=1}return _createClass(t,[{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,0<this.children.length&&this.setChildDepth(this.children[0])}},{key:"setChildDepth",value:function(t){var i=100*this._depth+t.childIndex;console.log(i),null==t.scene&&(t.scene=gw.model.currentScene),t.depth=i,null!=t.nextChild&&this.setChildDepth(t.nextChild)}},{key:"x",get:function(){return this._x},set:function(t){this._oldX=this._x,this._x=t,this.updatePositions()}},{key:"y",get:function(){return this._y},set:function(t){this._oldY=this._y,this._y=t,this.updatePositions()}},{key:"add",value:function(t){this.childIndex++,t.childIndex=this.childIndex,this.children.push(t),this.buildList()}},{key:"removeChild",value:function(t){this.children.splice(t.childIndex,1),this.buildList();for(var i=this.children.length,e=0;e<i;e++)this.children[e].childIndex=e;this.childIndex=i}},{key:"buildList",value:function(){var t=this.children.length;if(1<t)for(var i=1;i<t;i++)this.children[i-1].nextChild=this.children[i];this.children[t-1].nextChild=null}},{key:"willRender",value:function(){}},{key:"displayWidth",get:function(){return this._displayWidth}},{key:"displayHeight",get:function(){return this._displayHeight}},{key:"setSize",value:function(t,i){this._displayWidth=t,this._displayHeight=i}},{key:"setXY",value:function(t,i){this.x=t,this.y=i,this.updatePositions()}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible!=t&&(this._visible=t,0<this.children.length)&&this.updateChildVisible(this.children[0],t)}},{key:"alpha",get:function(){return this._alpha},set:function(t){this._alpha!=t&&(this._alpha=t,0<this.children.length)&&this.updateChildAlpha(this.children[0],t)}},{key:"setScrollFactor",value:function(t){0<this.children.length&&this.updateChildScroll(this.children[0],t)}},{key:"updateChildScroll",value:function(t,i){t.setScrollFactor(i),t.nextChild&&t.nextChild.setScrollFactor(i)}},{key:"updateChildAlpha",value:function(t,i){t.alpha=i,1==t.isPosBlock&&(t.alpha=i),null!=t.nextChild&&this.updateChildAlpha(t.nextChild,i)}},{key:"updateChildVisible",value:function(t,i){t.visible=i,1==t.isPosBlock&&(t.visible=i),null!=t.nextChild&&this.updateChildVisible(t.nextChild,i)}},{key:"updateChildPos",value:function(t){t.y=t.y-this._oldY+this._y,t.x=t.x-this._oldX+this._x,1==t.isPosBlock&&t.updatePositions(),null!=t.nextChild&&this.updateChildPos(t.nextChild),this._oldX=this._x,this._oldY=this._y}},{key:"updatePositions",value:function(){this.children&&0<this.children.length&&this.updateChildPos(this.children[0])}},{key:"getRelPos",value:function(t){return{x:t.x-this.x,y:t.y-this.y}}},{key:"once",value:function(t,i,e){}},{key:"getChildren",value:function(t,i){t.push(i),i.isPosBlock&&0<i.children.length&&i.getChildren(t,i.children[0]),i.nextChild&&this.getChildren(t,i.nextChild)}},{key:"getAllChildren",value:function(){var t=[];return 0<this.children.length&&this.getChildren(t,this.children[0]),t}},{key:"getChildAt",value:function(t){return this.children[t]}},{key:"setMask",value:function(i){this.getAllChildren().forEach(function(t){t.setMask(i)}.bind(this))}},{key:"destroy",value:function(){for(var t=this.getAllChildren(),i=(this.childIndex=-1,t.length),e=0;e<i;e++)t[e].destroy();this.children.length=0,t.length=0}}]),t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlVJQmxvY2suanMiXSwibmFtZXMiOlsiVUlCbG9jayIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJfeCIsIl95IiwiX29sZFgiLCJfb2xkWSIsIl92aXNpYmxlIiwiX2Rpc3BsYXlIZWlnaHQiLCJjaGlsZHJlbiIsImlzUG9zQmxvY2siLCJfYWxwaGEiLCJfY3JlYXRlQ2xhc3MiLCJrZXkiLCJnZXQiLCJfZGVwdGgiLCJzZXQiLCJjaGlsZEluZGV4IiwidmFsIiwibGVuZ3RoIiwic2V0Q2hpbGREZXB0aCIsInZhbHVlIiwicmVhbERlcHRoIiwiY2hpbGQiLCJjb25zb2xlIiwibG9nIiwidW5kZWZpbmVkIiwic2NlbmUiLCJjdXJyZW50U2NlbmUiLCJkZXB0aCIsIm5leHRDaGlsZCIsInVwZGF0ZVBvc2l0aW9ucyIsInB1c2giLCJidWlsZExpc3QiLCJzcGxpY2UiLCJsZW4iLCJpIiwiX2Rpc3BsYXlXaWR0aCIsInciLCJoIiwieSIsIngiLCJ1cGRhdGVDaGlsZFZpc2libGUiLCJ1cGRhdGVDaGlsZFNjcm9sbCIsInNjcm9sbCIsInNldFNjcm9sbEZhY3RvciIsImFscGhhIiwidXBkYXRlQ2hpbGRBbHBoYSIsInZpcyIsInZpc2libGUiLCJ1cGRhdGVDaGlsZFBvcyIsInQiLCJlIiwibXlBcnJheSIsImdldENoaWxkcmVuIiwiY2hpbGRBcnJheSIsImluZGV4IiwibWFzayIsImdldEFsbENoaWxkcmVuIiwiZm9yRWFjaCIsImJpbmQiLCJkZXN0cm95Il0sIm1hcHBpbmdzIjoia2pDQUFNQSxRQUFPLFdBQ1QsU0FBQUEsSUFBY0MsZ0JBQUFDLEtBQUFGLENBQUEsRUFFVkUsS0FBS0MsR0FBSyxFQUNWRCxLQUFLRSxHQUFLLEVBSEFGLEtBQUFHLE1BQUEsRUFDVkgsS0FBQUksTUFBQSxFQUdBSixLQUFBSyxTQUFBLENBQUEsRUFJSUwsS0FBQ0ksY0FBUyxFQUNkSixLQUFBTSxlQUFBLEVBSUFOLEtBQUFPLFNBQUEsR0FHSVAsS0FBQ00sV0FBaUIsQ0FBQyxF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YUFBQVEsTUFDRCxTQTdDV21DLEdBQ1AsT0FBU3RELEtBQUNRLFNBQVU4QyxFQThDeEIsQ0FBQyxFQUFBLENBQUEzQyxJQUFBLFVBQUFRLE1BQ0QsU0E3Q0lvQyxHQUVJdkQsS0FBQXdELGVBQUEsRUFBQUMsUUFBQSxTQUFBcEMsR0FDSUEsRUFBQzJCLFFBQUFBLENBQWUzQixDQUN4QixFQUFBcUMsS0FBQTFELElBQUEsQ0FBQSxDQThDSixDQUFDLEVBQUEsQ0FBQVcsSUFBQSxVQUFBUSxNQUNELFdBM0NDLElBREcsSUFBS2YsRUFBYUYsS0FBRXNELGVBQUEsRUFDdkJ2QixHQUFEakMsS0FBQWUsV0FBQSxDQUFBLEVBQUNzQyxFQUFBcEMsUUFDRGlCLEVBQUEsRUFBQUEsRUFBQUQsRUFBQUMsQ0FBQSxHQUNRbUIsRUFBYW5CLEdBQUV5QixRQUFBLEVBaURuQjNELEtBL0NRTyxTQUFBVSxPQUFBLEVBZ0RSb0MsRUEvQ2FMLE9BQUFBLENBZ0RqQixDQUFDLEVBQUEsRUFBQWxELENBQUEsRUFBQSIsImZpbGUiOiJVSUJsb2NrLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFVJQmxvY2sge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgLy9pbml0IHByaXZhdGUgdmFyaWFibGVzXHJcbiAgICAgICAgdGhpcy5feCA9IDA7XHJcbiAgICAgICAgdGhpcy5feSA9IDA7XHJcbiAgICAgICAgLy9cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8va2VlcCB0cmFjayBvZiB0aGlzIGJsb2NrJ3MgcHJldmlvdXMgcG9zaXRpb25cclxuICAgICAgICB0aGlzLl9vbGRYID0gMDtcclxuICAgICAgICB0aGlzLl9vbGRZID0gMDtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5fdmlzaWJsZSA9IHRydWU7XHJcbiAgICAgICAgLy9cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vbmVlZHMgdG8gYmUgc2V0IGJ5IGRldmVsb3BlclxyXG4gICAgICAgIHRoaXMuX2Rpc3BsYXlXaWR0aCA9IDA7XHJcbiAgICAgICAgdGhpcy5fZGlzcGxheUhlaWdodCA9IDA7XHJcbiAgICAgICAgLy9cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vYW4gYXJyYXkgb2YgdGhlIGNoaWxkcmVuXHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIC8vY3VycmVudCBjaGlsZCBjb3VudFxyXG4gICAgICAgIC8vdXNlZCBmb3IgaW5kZXhpbmdcclxuICAgICAgICB0aGlzLmNoaWxkSW5kZXggPSAtMTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vdXNlZCB0byBpZGVudGlmeSB0aGlzIGFzIGEgVUlCbG9jayB0byBhbm90aGVyIFVJQmxvY2tcclxuICAgICAgICB0aGlzLmlzUG9zQmxvY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX2RlcHRoID0gMTtcclxuICAgICAgICB0aGlzLl9hbHBoYSA9IDE7XHJcbiAgICB9XHJcbiAgICBzZXQgZGVwdGgodmFsKSB7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyh2YWwpO1xyXG4gICAgICAgIHRoaXMuX2RlcHRoID0gdmFsO1xyXG4gICAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRDaGlsZERlcHRoKHRoaXMuY2hpbGRyZW5bMF0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBkZXB0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGVwdGg7XHJcbiAgICB9XHJcbiAgICBzZXRDaGlsZERlcHRoKGNoaWxkKSB7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhjaGlsZCk7XHJcbiAgICAgICAgdmFyIHJlYWxEZXB0aCA9IHRoaXMuX2RlcHRoICogMTAwICsgY2hpbGQuY2hpbGRJbmRleDtcclxuICAgICAgICBjb25zb2xlLmxvZyhyZWFsRGVwdGgpO1xyXG4gICAgICAgIGlmIChjaGlsZC5zY2VuZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY2hpbGQuc2NlbmUgPSBndy5tb2RlbC5jdXJyZW50U2NlbmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoaWxkLmRlcHRoID0gcmVhbERlcHRoO1xyXG4gICAgICAgIC8vICBjaGlsZC5zZXREZXB0aChyZWFsRGVwdGgpO1xyXG4gICAgICAgIGlmIChjaGlsZC5uZXh0Q2hpbGQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnNldENoaWxkRGVwdGgoY2hpbGQubmV4dENoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzZXQgeCh2YWwpIHtcclxuICAgICAgICAvL3JlY29yZCB0aGUgY3VycmVudCB4IGludG8gb2xkWFxyXG4gICAgICAgIHRoaXMuX29sZFggPSB0aGlzLl94O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy91cGRhdGUgdGhlIHZhbHVlXHJcbiAgICAgICAgdGhpcy5feCA9IHZhbDtcclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vdXBkYXRlIHRoZSBjaGlsZHJlblxyXG4gICAgICAgIHRoaXMudXBkYXRlUG9zaXRpb25zKCk7XHJcbiAgICB9XHJcbiAgICBzZXQgeSh2YWwpIHtcclxuICAgICAgICAvL3JlY29yZCB0aGUgY3VycmVudCB5IGludG8gb2xkWVxyXG4gICAgICAgIHRoaXMuX29sZFkgPSB0aGlzLl95O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgLy91cGRhdGUgdGhlIHZhbHVlXHJcbiAgICAgICAgdGhpcy5feSA9IHZhbDtcclxuICAgICAgICAvL3VwZGF0ZSB0aGUgY2hpbGRyZW5cclxuICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9ucygpO1xyXG4gICAgfVxyXG4gICAgLy9nZXR0ZXJzXHJcbiAgICBnZXQgeCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5feDtcclxuICAgIH1cclxuICAgIGdldCB5KCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl95O1xyXG4gICAgfVxyXG4gICAgLy9hZGQgYSBjaGlsZFxyXG4gICAgYWRkKGNoaWxkKSB7XHJcbiAgICAgICAgLy91cCB0aGUgaW5kZXhcclxuICAgICAgICB0aGlzLmNoaWxkSW5kZXgrKztcclxuICAgICAgICAvL21ha2UgYSBub3RlIG9mIHRoZSBpbmRleCBpbnNpZGUgdGhlIGNoaWxkXHJcbiAgICAgICAgY2hpbGQuY2hpbGRJbmRleCA9IHRoaXMuY2hpbGRJbmRleDtcclxuICAgICAgICAvL2FkZCB0byB0aGUgYXJyYXlcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goY2hpbGQpO1xyXG4gICAgICAgIC8vYnVpbGQgdGhlIGxpbmtlZCBsaXN0XHJcbiAgICAgICAgdGhpcy5idWlsZExpc3QoKTtcclxuICAgIH1cclxuICAgLyogcmVtb3ZlQXZhdGFyKHVzZXJJRCkge1xyXG4gICAgICAgIGlmICh0aGlzLmF2YXRhcnNbdXNlcklEXSkge1xyXG4gICAgICAgICAgICB2YXIgYXZhdGFyID0gdGhpcy5hdmF0YXJzW3VzZXJJRF07XHJcbiAgICAgICAgICAgIGlmIChhdmF0YXIucHJldkF2YXRhcikgYXZhdGFyLnByZXZBdmF0YXIubmV4dEF2YXRhciA9IGF2YXRhci5uZXh0QXZhdGFyO1xyXG4gICAgICAgICAgICBhdmF0YXIuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5hdmF0YXJzW3VzZXJJRF07XHJcbiAgICAgICAgfVxyXG4gICAgfSovXHJcbiAgICByZW1vdmVDaGlsZChjaGlsZCkge1xyXG4gICAgICAgIC8vdGFrZSB0aGUgY2hpbGQgb2ZmIHRoZSBhcnJheSBiYXNlZCBvbiBpbmRleFxyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGNoaWxkLmNoaWxkSW5kZXgsIDEpO1xyXG5cclxuICAgICAgICAvL1xyXG4gICAgICAgIC8vcmVidWlsZCB0aGUgbGlua2VkIGxpc3RcclxuICAgICAgICB0aGlzLmJ1aWxkTGlzdCgpO1xyXG4gICAgICAgIC8vcmVidWlsZCB0aGUgaW5kZXhlc1xyXG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5baV0uY2hpbGRJbmRleCA9IGk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vc2V0IHRoZSBjaGlsZEluZGV4IHRvIHRoZSBsZW5ndGggb2YgdGhlIGFycmF5XHJcbiAgICAgICAgdGhpcy5jaGlsZEluZGV4ID0gbGVuO1xyXG4gICAgfVxyXG4gICAgYnVpbGRMaXN0KCkge1xyXG4gICAgICAgIHZhciBsZW4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICBpZiAobGVuID4gMSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvL3NldCB0aGUgY3VycmVudCBjaGlsZCB0byB0aGUgcHJldmlvdXMgY2hpbGQncyBuZXh0Q2hpbGQgcHJvcGVydHlcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hpbGRyZW5baSAtIDFdLm5leHRDaGlsZCA9IHRoaXMuY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbltsZW4gLSAxXS5uZXh0Q2hpbGQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgd2lsbFJlbmRlcigpXHJcbiAgICB7XHJcblxyXG4gICAgfVxyXG4gICAgZ2V0IGRpc3BsYXlXaWR0aCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fZGlzcGxheVdpZHRoO1xyXG4gICAgfVxyXG4gICAgZ2V0IGRpc3BsYXlIZWlnaHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BsYXlIZWlnaHQ7XHJcbiAgICB9XHJcbiAgICBzZXRTaXplKHcsIGgpIHtcclxuICAgICAgICB0aGlzLl9kaXNwbGF5V2lkdGggPSB3O1xyXG4gICAgICAgIHRoaXMuX2Rpc3BsYXlIZWlnaHQgPSBoO1xyXG4gICAgfVxyXG4gICAgc2V0WFkoeCwgeSkge1xyXG4gICAgICAgIHRoaXMueCA9IHg7XHJcbiAgICAgICAgdGhpcy55ID0geTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9ucygpO1xyXG4gICAgfVxyXG4gICAgc2V0IHZpc2libGUodmFsKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3Zpc2libGUgIT0gdmFsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Zpc2libGUgPSB2YWw7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vc2VuZCB0aGUgZmlyc3QgY2hpbGQgdG8gdGhlIHVwZGF0ZUNoaWxkVmlzaWJsZSBmdW5jdGlvblxyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVDaGlsZFZpc2libGUodGhpcy5jaGlsZHJlblswXSwgdmFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCB2aXNpYmxlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl92aXNpYmxlO1xyXG4gICAgfVxyXG4gICAgLy9cclxuICAgIC8vXHJcbiAgICAvL1xyXG4gICAgLy9cclxuICAgIHNldCBhbHBoYSh2YWwpIHtcclxuICAgICAgICBpZiAodGhpcy5fYWxwaGEgIT0gdmFsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FscGhhID0gdmFsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAvL3NlbmQgdGhlIGZpcnN0IGNoaWxkIHRvIHRoZSB1cGRhdGVDaGlsZGFscGhhIGZ1bmN0aW9uXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoaWxkQWxwaGEodGhpcy5jaGlsZHJlblswXSwgdmFsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldCBhbHBoYSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYWxwaGE7XHJcbiAgICB9XHJcbiAgICBzZXRTY3JvbGxGYWN0b3Ioc2Nyb2xsKSB7XHJcbiAgICAgICAgLy9zZXRTY3JvbGxGYWN0b3JcclxuICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIC8vc2VuZCB0aGUgZmlyc3QgY2hpbGQgdG8gdGhlIHVwZGF0ZUNoaWxkYWxwaGEgZnVuY3Rpb25cclxuICAgICAgICAgICAgdGhpcy51cGRhdGVDaGlsZFNjcm9sbCh0aGlzLmNoaWxkcmVuWzBdLCBzY3JvbGwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHVwZGF0ZUNoaWxkU2Nyb2xsKGNoaWxkLCBzY3JvbGwpIHtcclxuICAgICAgICBjaGlsZC5zZXRTY3JvbGxGYWN0b3Ioc2Nyb2xsKTtcclxuICAgICAgICBpZiAoY2hpbGQubmV4dENoaWxkKSB7XHJcbiAgICAgICAgICAgIGNoaWxkLm5leHRDaGlsZC5zZXRTY3JvbGxGYWN0b3Ioc2Nyb2xsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB1cGRhdGVDaGlsZEFscGhhKGNoaWxkLCBhbHBoYSkge1xyXG4gICAgICAgIGNoaWxkLmFscGhhID0gYWxwaGE7XHJcbiAgICAgICAgaWYgKGNoaWxkLmlzUG9zQmxvY2sgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjaGlsZC5hbHBoYSA9IGFscGhhO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hpbGQubmV4dENoaWxkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgLy9pZiB0aGUgY2hpbGQgaGFzIGEgbmV4dENoaWxkIGNhbGwgdGhpcyBmdW5jdGlvbiByZWN1cnNpdmVseSBcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVDaGlsZEFscGhhKGNoaWxkLm5leHRDaGlsZCwgYWxwaGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHVwZGF0ZUNoaWxkVmlzaWJsZShjaGlsZCwgdmlzKSB7XHJcbiAgICAgICAgY2hpbGQudmlzaWJsZSA9IHZpcztcclxuICAgICAgICBpZiAoY2hpbGQuaXNQb3NCbG9jayA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIGNoaWxkLnZpc2libGUgPSB2aXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGlsZC5uZXh0Q2hpbGQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAvL2lmIHRoZSBjaGlsZCBoYXMgYSBuZXh0Q2hpbGQgY2FsbCB0aGlzIGZ1bmN0aW9uIHJlY3Vyc2l2ZWx5IFxyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNoaWxkVmlzaWJsZShjaGlsZC5uZXh0Q2hpbGQsIHZpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgdXBkYXRlQ2hpbGRQb3MoY2hpbGQpIHtcclxuICAgICAgICBjaGlsZC55ID0gY2hpbGQueSAtIHRoaXMuX29sZFkgKyB0aGlzLl95O1xyXG4gICAgICAgIGNoaWxkLnggPSBjaGlsZC54IC0gdGhpcy5fb2xkWCArIHRoaXMuX3g7XHJcbiAgICAgICAgaWYgKGNoaWxkLmlzUG9zQmxvY2sgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICBjaGlsZC51cGRhdGVQb3NpdGlvbnMoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNoaWxkLm5leHRDaGlsZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIC8vaWYgdGhlIGNoaWxkIGhhcyBhIG5leHRDaGlsZCBjYWxsIHRoaXMgZnVuY3Rpb24gcmVjdXJzaXZlbHkgXHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlQ2hpbGRQb3MoY2hpbGQubmV4dENoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9zZXQgdGhlIG9sZCB2YWx1ZXMgdG8gdGhlIG5ld1xyXG4gICAgICAgIHRoaXMuX29sZFggPSB0aGlzLl94O1xyXG4gICAgICAgIHRoaXMuX29sZFkgPSB0aGlzLl95O1xyXG4gICAgfVxyXG4gICAgdXBkYXRlUG9zaXRpb25zKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIC8vc2VuZCB0aGUgZmlyc3QgY2hpbGQgdG8gdGhlIHVwZGF0ZUNoaWxkUG9zIGZ1bmN0aW9uXHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUNoaWxkUG9zKHRoaXMuY2hpbGRyZW5bMF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0UmVsUG9zKGNoaWxkKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeDogY2hpbGQueCAtIHRoaXMueCxcclxuICAgICAgICAgICAgeTogY2hpbGQueSAtIHRoaXMueVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIG9uY2UodCwgZSwgaSkge31cclxuICAgIGdldENoaWxkcmVuKG15QXJyYXksIGNoaWxkKSB7XHJcbiAgICAgICAgbXlBcnJheS5wdXNoKGNoaWxkKTtcclxuICAgICAgICBpZiAoY2hpbGQuaXNQb3NCbG9jaykge1xyXG4gICAgICAgICAgICBpZiAoY2hpbGQuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQuZ2V0Q2hpbGRyZW4obXlBcnJheSwgY2hpbGQuY2hpbGRyZW5bMF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGlsZC5uZXh0Q2hpbGQpIHtcclxuICAgICAgICAgICAgdGhpcy5nZXRDaGlsZHJlbihteUFycmF5LCBjaGlsZC5uZXh0Q2hpbGQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdldEFsbENoaWxkcmVuKCkge1xyXG4gICAgICAgIHZhciBjaGlsZEFycmF5ID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmdldENoaWxkcmVuKGNoaWxkQXJyYXksIHRoaXMuY2hpbGRyZW5bMF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY2hpbGRBcnJheTtcclxuICAgIH1cclxuICAgIGdldENoaWxkQXQoaW5kZXgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbltpbmRleF07XHJcbiAgICB9XHJcbiAgICBzZXRNYXNrKG1hc2spXHJcbiAgICB7XHJcbiAgICAgICAgdGhpcy5nZXRBbGxDaGlsZHJlbigpLmZvckVhY2goZnVuY3Rpb24oY2hpbGQpIHtcclxuICAgICAgICAgICAgY2hpbGQuc2V0TWFzayhtYXNrKTtcclxuICAgICAgICB9LmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG4gICAgZGVzdHJveSgpIHtcclxuICAgICAgICB2YXIgY2hpbGRBcnJheSA9IHRoaXMuZ2V0QWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICB0aGlzLmNoaWxkSW5kZXg9LTE7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhjaGlsZEFycmF5KTtcclxuICAgICAgICB2YXIgbGVuID0gY2hpbGRBcnJheS5sZW5ndGg7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBjaGlsZEFycmF5W2ldLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGg9MDtcclxuICAgICAgICBjaGlsZEFycmF5Lmxlbmd0aD0wO1xyXG4gICAgfVxyXG59Il19
